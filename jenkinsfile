
pipeline {
    agent any
    
    stages {
    
         stage("checkout") {
             steps {
                 git branch:'main', url:'https://github.com/denismug/course3-jenkins-gs-spring-petclinic'
             }
         }
         stage("build") {
             steps {
             sh "./mvnw package"
             }
         }
         
         stage("capture") {
             steps {
             archiveArtifacts artifacts: '**/target/*.jar', followSymlinks: false
             jacoco()
             junit '**/target/surefire-reports/TEST*.xml'
             }
         }
    }
    
    post {
        regression {
            //email body
            emailext body: '${env.BUILD_URL}\n${currentBuild.absoluteURL}', 
            to: 'denis.mugisha@akelius.com',
            recipientProviders: [previous()], 
            subject: '"${currentBuild.currentResutl}: Job ${env.JOB_NAME} [${env.BUILD_NUMBER}]'
        }
    }
}
